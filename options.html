<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="options_title">AI Tabs 设置</title>
  <link rel="stylesheet" href="styles/common.css">
  <link rel="stylesheet" href="styles/options.css">
</head>
<body class="options-page-body">
  <div class="options-layout">
    <!-- 左侧菜单栏 -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2 data-i18n="options_title">AI Tabs 设置</h2>
      </div>
      
      <nav class="sidebar-nav">
        <ul class="nav-menu">
          <li class="nav-item">
            <button class="nav-button active" data-page="general" data-i18n="nav_general">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
              </svg>
              <span data-i18n="nav_general">常规设置</span>
            </button>
          </li>
          
          <li class="nav-item">
            <button class="nav-button" data-page="providers" data-i18n="nav_providers">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 19c-5 0-8-3-8-8s3-8 8-8 8 3 8 8-3 8-8 8z"></path>
                <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                <path d="M12 1v6m0 6v6"></path>
              </svg>
              <span data-i18n="nav_providers">模型供应商</span>
            </button>
          </li>
          
          <li class="nav-item">
            <button class="nav-button" data-page="advanced" data-i18n="nav_advanced">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9 8.91 8.26 12 2"></polygon>
              </svg>
              <span data-i18n="nav_advanced">高级设置</span>
            </button>
          </li>
          
          <li class="nav-item">
            <button class="nav-button" data-page="about" data-i18n="nav_about">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              <span data-i18n="nav_about">关于</span>
            </button>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- 右侧内容区域 -->
    <main class="main-content">
      <!-- 常规设置页面 -->
      <div class="content-page active" id="page-general">
        <div class="page-header">
          <h3 data-i18n="nav_general">常规设置</h3>
          <p data-i18n="general_description">配置基本的AI服务设置和偏好</p>
        </div>
        
        <div class="settings-section">
          <div class="form-group">
            <label for="languageSelect" data-i18n="language_setting">界面语言</label>
            <select id="languageSelect">
              <option value="auto" data-i18n="language_auto">自动检测</option>
              <option value="zh_CN" data-i18n="language_zh_cn">简体中文</option>
              <option value="en" data-i18n="language_en">English</option>
            </select>
            <small class="form-description" data-i18n="language_setting_description">更改语言后需要重新加载扩展</small>
          </div>
        </div>
      </div>

      <!-- 模型供应商页面 -->
      <div class="content-page" id="page-providers">
        <div class="page-header">
          <h3 data-i18n="nav_providers">模型供应商</h3>
          <p data-i18n="providers_description">管理AI模型供应商和相关配置</p>
        </div>

        <div class="provider-tabs">
          <div class="tab-buttons">
            <button class="tab-button active" data-tab="current" data-i18n="tab_current_provider">当前配置</button>
            <button class="tab-button" data-tab="manage" data-i18n="tab_manage_providers">管理供应商</button>
          </div>

          <!-- 当前供应商配置 -->
          <div class="tab-content active" id="tab-current">
            <div class="settings-section">
              <div class="form-group">
                <label for="providerSelect" data-i18n="provider_select">选择供应商</label>
                <select id="providerSelect">
                  <option value="openai" data-i18n="provider_openai"></option>
                  <option value="deepseek" data-i18n="provider_deepseek"></option>
                  <option value="anthropic" data-i18n="provider_anthropic"></option>
                  <option value="google" data-i18n="provider_google"></option>
                  <option value="alibaba" data-i18n="provider_alibaba"></option>
                  <option value="baidu" data-i18n="provider_baidu"></option>
                  <option value="zhipu" data-i18n="provider_zhipu"></option>
                  <option value="moonshot" data-i18n="provider_moonshot"></option>
                  <option value="01ai" data-i18n="provider_01ai"></option>
                  <option value="minimax" data-i18n="provider_minimax"></option>
                  <option value="doubao" data-i18n="provider_doubao"></option>
                  <option value="xunfei" data-i18n="provider_xunfei"></option>
                  <option value="sensetime" data-i18n="provider_sensetime"></option>
                  <option value="stepfun" data-i18n="provider_stepfun"></option>
                  <option value="tencent" data-i18n="provider_tencent"></option>
                  <option value="custom" data-i18n="provider_custom"></option>
                </select>
                <small class="form-description" data-i18n="provider_select_description">选择您要使用的AI服务供应商</small>
              </div>

              <!-- 供应商配置状态 -->
              <div id="providerConfigStatus" class="provider-config-status" style="display: none;">
                <div class="config-status-item">
                  <span class="config-label" data-i18n="api_key_status">API密钥状态</span>
                  <span id="apiKeyStatus" class="config-value">未配置</span>
                </div>
                <div class="config-status-item">
                  <span class="config-label" data-i18n="base_url_status">基础URL</span>
                  <span id="baseURLStatus" class="config-value">--</span>
                </div>
                <div class="config-status-item">
                  <span class="config-label" data-i18n="selected_model_status">选择的模型</span>
                  <span id="selectedModelStatus" class="config-value">未选择</span>
                </div>
                <button type="button" id="configureProviderBtn" class="btn btn-primary btn-small" data-i18n="configure_provider">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 20h9"></path>
                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                  </svg>
                  <span>配置此供应商</span>
                </button>
              </div>

              <!-- 供应商配置表单（点击配置时显示） -->
              <div id="providerConfigForm" class="provider-config-form" style="display: none;">
                <div class="form-group">
                  <label for="baseURL" id="baseURLLabel" data-i18n="base_url">API基础URL</label>
                  <input type="text" id="baseURL" data-i18n-placeholder="base_url_placeholder">
                  <small class="form-description" data-i18n="base_url_description">API服务的基础地址</small>
                </div>

                <div class="form-group">
                  <label for="apiKey" data-i18n="api_key">API密钥</label>
                  <div class="password-input-container">
                    <input type="password" id="apiKey" data-i18n-placeholder="api_key_placeholder">
                    <button type="button" id="toggleApiKeyBtn" class="toggle-password-btn" data-i18n-title="toggle_password_visibility" title="显示/隐藏密码">
                      <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                      <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94L6.06 6.06"></path>
                        <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19l-1.65-1.65"></path>
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                      </svg>
                    </button>
                  </div>
                  <small class="form-description" data-i18n="api_key_description">您的API访问密钥，将安全存储</small>
                </div>

                <div class="form-group">
                  <label for="modelSelect" data-i18n="model_select">选择模型</label>
                  <div class="model-select-container">
                    <select id="modelSelect">
                      <option value="" data-i18n="model_select_prompt">请先配置API密钥</option>
                    </select>
                    <button type="button" id="refreshModelsBtn" class="refresh-btn" title="刷新模型列表">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                      </svg>
                      <div class="cache-indicator" id="cacheIndicator"></div>
                    </button>
                  </div>
                  <small class="form-description" data-i18n="model_select_description">选择要使用的AI模型</small>
                </div>

                <div class="form-actions">
                  <button type="button" id="saveConfigBtn" class="btn btn-primary" data-i18n="save_settings">保存</button>
                  <button type="button" id="cancelConfigFormBtn" class="btn btn-secondary" data-i18n="cancel">取消</button>
                </div>
              </div>

              <!-- 全局分组策略配置 -->
              <div class="settings-section">
                <h4 data-i18n="global_settings">全局设置</h4>
                <div class="form-group">
                  <label for="groupingStrategy" data-i18n="grouping_strategy">分组策略</label>
                  <input type="text" id="groupingStrategy" data-i18n-placeholder="grouping_strategy_placeholder">
                  <small class="form-description" data-i18n="grouping_strategy_description">标签页分组的策略设置</small>
                </div>
                <div class="form-actions">
                  <button type="button" id="saveGlobalSettingsBtn" class="btn btn-primary" data-i18n="save_settings">保存</button>
                </div>
              </div>
            </div>
          </div>

          <!-- 管理供应商 -->
          <div class="tab-content" id="tab-manage">
            <div class="providers-management">
              <div class="providers-header">
                <h4 data-i18n="configured_providers">已配置供应商</h4>
                <button type="button" id="addProviderBtn" class="btn btn-primary btn-small" data-i18n="add_custom_provider">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  <span>添加自定义供应商</span>
                </button>
              </div>
              
              <div id="providersList" class="providers-items">
                <!-- 动态生成的供应商列表 -->
              </div>

              <!-- 添加/编辑自定义供应商表单 -->
              <div id="providerForm" class="provider-form" style="display: none;">
                <h4 id="formTitle" data-i18n="add_custom_provider">添加自定义供应商</h4>
                
                <div class="form-group">
                  <label for="providerName" data-i18n="provider_name">供应商名称</label>
                  <input type="text" id="providerName" data-i18n-placeholder="provider_name_placeholder" required>
                  <small class="form-description" data-i18n="provider_name_description">为您的AI供应商起一个容易识别的名称</small>
                </div>
                
                <!-- 隐藏的供应商标识字段，由系统自动生成 -->
                <input type="hidden" id="providerKey">
                
                <div class="form-group">
                  <label for="providerBaseURL" data-i18n="provider_base_url">API基础URL</label>
                  <input type="url" id="providerBaseURL" data-i18n-placeholder="provider_base_url_placeholder" required>
                </div>
                
                <div class="form-group">
                  <label for="providerEndpoint" data-i18n="provider_endpoint">聊天端点</label>
                  <input type="text" id="providerEndpoint" value="/chat/completions" data-i18n-placeholder="provider_endpoint_placeholder">
                </div>
                
                <div class="form-group">
                  <label for="providerModels" data-i18n="provider_default_models">默认模型</label>
                  <textarea id="providerModels" rows="3" data-i18n-placeholder="provider_models_placeholder"></textarea>
                  <small class="form-description" data-i18n="provider_models_description">每行输入一个模型名称，留空将自动从API获取</small>
                </div>
                
                <div class="form-actions">
                  <button type="button" id="saveProviderBtn" class="btn btn-primary" data-i18n="save_provider">保存供应商</button>
                  <button type="button" id="cancelProviderBtn" class="btn btn-secondary" data-i18n="cancel">取消</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 高级设置页面 -->
      <div class="content-page" id="page-advanced">
        <div class="page-header">
          <h3 data-i18n="nav_advanced">高级设置</h3>
          <p data-i18n="advanced_description">高级功能和性能优化设置</p>
        </div>
        
        <div class="settings-section">
          <div class="advanced-settings-container">
            <div class="form-group">
              <label for="maxTabs" data-i18n="max_tabs">最大标签页数量</label>
              <input type="number" id="maxTabs" min="1" max="100">
              <small class="form-description" data-i18n="max_tabs_description">同时处理的最大标签页数量</small>
            </div>
            
            <div class="form-group checkbox-group">
              <label for="autoSave" data-i18n="auto_save">自动保存</label>
              <input type="checkbox" id="autoSave">
              <small class="form-description" data-i18n="auto_save_description">自动保存配置更改</small>
            </div>
            
            <div class="form-group">
              <label for="cacheTimeout" data-i18n="cache_timeout">缓存超时时间（分钟）</label>
              <input type="number" id="cacheTimeout" min="1" max="1440">
              <small class="form-description" data-i18n="cache_timeout_description">模型列表缓存的有效时间</small>
            </div>
          </div>
          
          <div class="form-actions">
            <button id="clearCacheBtn" class="btn btn-secondary" data-i18n="clear_cache">清除缓存</button>
            <button id="resetSettingsBtn" class="btn btn-secondary" data-i18n="reset_settings">重置设置</button>
          </div>
        </div>
      </div>

      <!-- 关于页面 -->
      <div class="content-page" id="page-about">
        <div class="page-header">
          <h3 data-i18n="nav_about">关于 AI Tabs</h3>
          <p data-i18n="about_description">扩展信息和帮助文档</p>
        </div>
        
        <div class="settings-section">
          <div class="about-content">
            <div class="about-item">
              <h4 data-i18n="version">版本</h4>
              <p>v1.0.0</p>
            </div>
            
            <div class="about-item">
              <h4 data-i18n="description">描述</h4>
              <p data-i18n="app_description">智能AI标签页管理扩展，支持多种AI服务供应商</p>
            </div>
            
            <div class="about-item">
              <h4 data-i18n="features">主要功能</h4>
              <ul>
                <li data-i18n="feature_1">多AI供应商支持</li>
                <li data-i18n="feature_2">智能模型缓存</li>
                <li data-i18n="feature_3">安全密钥存储</li>
                <li data-i18n="feature_4">自定义供应商管理</li>
                <li data-i18n="feature_5">多语言界面</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- 状态提示 -->
      <div id="status" style="display: none;"></div>
    </main>
  </div>

  <script src="scripts/security.js"></script>
  <script src="i18n.js"></script>
  <script src="options.js"></script>
</body>
</html> 